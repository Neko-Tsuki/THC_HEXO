<!DOCTYPE html>
<html lang="<%- config.language %>">
  <%- partial('_partial/scripts/_ctrl') _%>
  <%- partial('_partial/head') _%>
  <body itemscope itemtype="http://schema.org/WebPage">
    <!-- import body_begin begin-->
    <%_ if (config.import && config.import.body_begin){ _%>
      <%_ getList(config.import.body_begin).forEach(function(item){ _%>
        <%- item %>
      <%_ }) _%>
    <%_ } _%>
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    <!-- 公告栏开始 -->
    <% if (theme.announcement && theme.announcement.enable) { %>
      <div class="announcement-bar" style="background: <%= theme.announcement.background %>; color: <%= theme.announcement.color %>; padding: 10px; font-size: 16px; border-bottom: 1px solid #ddd; display: none;">
        <% if (theme.announcement.items && theme.announcement.items.length > 0) { %>
          <% for (let i = 0; i < theme.announcement.items.length; i++) { %>
            <div class="announcement-item" style="display: <%= i === 0 ? 'block' : 'none' %>;" data-index="<%= i %>">
              <% if (theme.announcement.items[i].link) { %>
                <a href="<%= theme.announcement.items[i].link %>" style="color: inherit; text-decoration: none; display: flex; align-items: center;">
                  <i class="<%= theme.announcement.items[i].icon %>" style="margin-right: 10px;"></i>
                  <span style="flex: 1; text-align: center;"><%= theme.announcement.items[i].text %></span>
                </a>
              <% } else { %>
                <div style="display: flex; align-items: center;">
                  <i class="<%= theme.announcement.items[i].icon %>" style="margin-right: 10px;"></i>
                  <span style="flex: 1; text-align: center;"><%= theme.announcement.items[i].text %></span>
                </div>
              <% } %>
            </div>
          <% } %>
        <% } else { %>
          <div style="display: flex; align-items: center;">
            <i class="<%= theme.announcement.icon %>" style="margin-right: 10px;"></i>
            <span style="flex: 1; text-align: center;"><%= theme.announcement.text %></span>
          </div>
        <% } %>
      </div>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          // 只在主页显示公告栏
          if (location.pathname === '/' || location.pathname === '/index.html') {
            const announcementBar = document.querySelector('.announcement-bar');
            if (announcementBar) {
              announcementBar.style.display = 'block';
              
              const announcementItems = announcementBar.querySelectorAll('.announcement-item');
              if (announcementItems.length > 1) {
                let currentIndex = 0;
                
                function showNextAnnouncement() {
                  announcementItems[currentIndex].style.display = 'none';
                  currentIndex = (currentIndex + 1) % announcementItems.length;
                  announcementItems[currentIndex].style.display = 'block';
                }
                
                // 每5秒切换一次公告
                setInterval(showNextAnnouncement, 5000);
              }
            }
          }
        });
        
        // PJAX 完成后检查是否需要显示公告栏
        document.addEventListener('pjax:complete', function() {
          const announcementBar = document.querySelector('.announcement-bar');
          if (announcementBar) {
            if (location.pathname === '/' || location.pathname === '/index.html') {
              announcementBar.style.display = 'block';
            } else {
              announcementBar.style.display = 'none';
            }
          }
        });
      </script>
    <% } %>
    <!-- 公告栏结束 -->
    <%- volantis_inject('bodyBegin') %>
    <!-- Custom Files bodyBegin end-->
    <!-- front-matter body_begin begin -->
    <%_ if (page.import && page.import.body_begin){ _%>
      <%_ getList(page.import.body_begin).forEach(function(item){ _%>
        <%- item %>
      <%_ }) _%>
    <%_ } _%>
    <!-- front-matter body_begin end -->
    <%- partial('_partial/header', null, {cache: false, path: path}) %>
    <div id="l_body">
      <%- partial('_partial/cover') %>
      <div id="safearea">
        <div class="body-wrapper">
          <%- body %>
          <%- partial('_plugins/pjax/pdata') %>
        </div>
        <%- partial('_partial/footer', null, {cache: !config.relative_link}) %>
        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" href="/" onclick="return false;" title="top"></a>
      </div>
    </div>
    <div>
      <%- partial('_partial/scripts/index') %>
      <% if (theme.plugins.pjax.enable){ %>
        <%- partial('_plugins/pjax/index') %>
      <% } %>
    </div>
    <!-- import body_end begin-->
    <%_ if (config.import && config.import.body_end){ _%>
      <%_ getList(config.import.body_end).forEach(function(item){ _%>
        <%- item %>
      <%_ }) _%>
    <%_ } _%>
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    <%- volantis_inject('bodyEnd') %>
    <!-- Custom Files bodyEnd end-->
    <!-- front-matter body_end begin -->
    <%_ if (page.import && page.import.body_end){ _%>
      <%_ getList(page.import.body_end).forEach(function(item){ _%>
        <%- item %>
      <%_ }) _%>
    <%_ } _%>
    <!-- front-matter body_end end -->
  </body>
</html>
